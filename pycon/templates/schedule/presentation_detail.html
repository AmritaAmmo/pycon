{% extends "site_base.html" %}

{% load account_tags %}
{% load compress %}
{% load i18n %}
{% load sitetree %}

{% block head_title %}{% trans "Presentation: " %}{{ presentation.title }}{% endblock %}

{% block breadcrumbs %}{% sitetree_breadcrumbs from "main" %}{% endblock %}

{% block body %}
    {% if presentation.slot %}
        <h4>
            {{ presentation.slot.day.date|date:"l" }}
            {{ presentation.slot.start}}&ndash;{{ presentation.slot.end }}
        </h4>
    {% endif %}
    <h2>{{ presentation.title }}</h2>

    <h4>
        {% for speaker in speakers %}
            <a href="{% url 'speaker_profile' speaker.pk %}">{{ speaker }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
    </h4>

    {% if proposal.category  %}
        <dl class="dl-horizontal">
            <dt>{% trans "Audience level:" %}</dt>
            <dd style="margin-bottom: 0;">{{ proposal.get_audience_level_display }}</dd>
            <dt>{% trans "Category:" %}</dt>
            <dd>{{ proposal.category }}</dd>
        </dl>
    {% endif %}

    <h3>{% trans "Description" %}</h3>

    <div class="description">{{ presentation.description }}</div>

    <h3>{% trans "Abstract" %}</h3>

    <div class="abstract">{{ presentation.abstract|safe }}</div>

    {% if proposal.handout and request.user in proposal.registrants  or request.user.speaker_profile in speakers or request.user.is_staff %}
        <h3>{% trans "Student Handout" %}</h3>
        <div class="student-handout"><a href="{{ proposal.handout.url }}">Download</a></div>

        <h3>{% trans "Messages" %}</h3>
       {% if proposal.tutorial_messages %}
          {% for message in proposal.tutorial_messages.all %}
            <div class="comment-box{% if not message.visible %} private{% endif %}">
              <div class="commment-content">
                <strong>{% user_display message.user %}</strong>
                {{ message.submitted_at|timesince }} ago
                <br />
                {{ message.message|safe }}
              </div>
            </div>
          {% endfor %}

        {% else %}
          No messages
        {% endif %}

          <form action="" method="POST" accept-charset="utf-8" id="applicant-list">
            {% csrf_token %}
            <div class="actions">
              <button type="submit" name="message_action" class="btn btn-primary">
                <i class="icon-pencil"></i>
                {% trans "Leave class note" %}
              </button>
            </div>
            {% if request.user.speaker_profile in speakers or request.user.is_staff %}
              <p><strong>{% trans "Select attendee(s) to email directly" %}</strong></p>
              <table class="table table-striped table-bordered table-messages">
                <thead>
                  <th>Attendee <i class="icon-sort"></i></th>
                </thead>
                <tbody>
                  {% for attendee in proposal.registrants.all %}
                    <tr>
                    <td>
                      <input type="checkbox" name="user_{{ attendee.pk }}">
                      <small><strong>{{ attendee.last_name }}, {{ attendee.first_name }}</strong></small>
                    </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
              <div class="actions">
                <button type="submit" name="email_action" class="btn btn-primary">
                  <i class="icon-envelope-alt"></i>
                  Send email
                </button>
              </div>
              </form>
              {% compress js %}
                <script src="{{ STATIC_URL }}datatables/js/jquery.dataTables.min.js" type="text/javascript"></script>
                <script src="{{ STATIC_URL }}tabletools/js/TableTools.min.js" type="text/javascript"></script>
                <script src="{{ STATIC_URL }}datatables/js/dataTables.bootstrap.js" type="text/javascript"></script>
                <script type="text/javascript">
                  $(function() {
                    $(".tip").tooltip();
                    $("table.table-messages").dataTable({
                      "sDom": "<'filter'<'sort'l><'search'f>r>t<'table-pagination'p>>",
                      "sPaginationType": "bootstrap",
                      "bStateSave": true
                    });
                  });

                </script>
              {% endcompress %}
            {% else %}
              </form>
            {% endif %}
    {% endif %}
{% endblock %}

